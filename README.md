# 1c TASKS

Автоматическая постановка задач из 1с в битрикс.
Приложение представляет из себя АПИ с 2мя методами. 
GET /ping/ - Проверка работоспособности сервиса
POST "/" - Постановка задачи. Принимает в себя json. Схему можно посмотреть по документации host:port/docs

* Параметр: прикрпеленные файлы в схеме необязателен.

## FAQ

- Где посмотреть пример отправляемого нам запроса? 
src/service/request_sample.json

- Как сервис понимает, какому сотруднику поставить задачу?
Самому незанятому сотруднику, из отдела Производство. Подотдел выбирается исходя из присланного запроса (Калькуляция, сравнивается по имени).

- Как понять: отработал сервис штатно или нет?
POST-запрос к корню может вернуть 3 результата:
1) Ответ с статус-кодом 200 и json - {'message': 'ok'} - задача/задачи были поставлены/обновлены успешно.
2) Ответ с статус-кодом 200 и json - {'message': 'При обновлении задачи произошла ошибка'} - Сообщение говорит само за себя. Скорее всего, эта возникает из-за того, что коробка была установлена на винде и через место, которое не стоит называть всуе. 
3) Ответ с статус кодом 500 и текстовым описанием исключения - Во время выполнения запроса произошла ошибка. Все исключения логгируются в файл log.log.

- Кеширует ли какие-то данные сервис? 
Да. Кешируется информация по подразделениям, людям в них и рабочему графику. Время кеширования можно посмотреть в соответствующих декораторах в файле requests.py.

## Требования

- python версии 3.13.0 и зависимости из requirements.txt

## Запуск

Проверьте, что в корне приложения есть файл .env где записан под ключом BITRIX_WEBHOOK - хук для отправки запросов битриксу.

- Первичная установка. Выполняется 1 раз.
1) Проверить, что установлен интерпретатор нужной версии.
2) Любым образом разместить файлы проекта локально.
3) Перейти в папку проекта и инициализировать виртуальное окружение. 
`python -m venv venv`
4) Активировать виртуальное окружение. Перед строчкой адреса в консоли должна появиться `(venv)` - свидетельство того, что виртуальное окружение активировано
`venv\scripts\activate`
5) В активированном окружении выполнить установку зависимостей приложения.
`pip install -r requirements.txt`

- Обычный запуск.
1) Активировать виртуальное окружение, если оно не активно.
`venv\scripts\activate`
2) перейти в папку src
`cd src`
3) Запустить приложение командой:
`uvicorn main:app`
uvicorn - http-cервер для обслуживания приложения. Он поддерживает множество комманд, которые можно посмотреть в интернете.
Пригодиться могут следующие:
`--host` - Для указания хоста для запуска. По умолчанию - 127.0.0.1
`--port` - Для указания порта для запуска. По умолчанию - 8000

## История изменений

- 16.12.2024 
Добавление связи проекта "Задачи из 1с" на каждую задачу.
- 26.11.2024
Приложение написано. Развернуто на сервере клиента.
